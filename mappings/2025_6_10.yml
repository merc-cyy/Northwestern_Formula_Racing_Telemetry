# Complete mapping from telemetry fields to CarDB attributes

# Time fields
"time_since_startup": "time.time_since_startup"
"unix_time": "???"

# BMS Faults (10 flags)
"BMS.BMS_Faults.Fault_Summary": "bms.faults[0]"
"BMS.BMS_Faults.Undervoltage_Fault": "bms.faults[1]"
"BMS.BMS_Faults.Overvoltage_Fault": "bms.faults[2]"
"BMS.BMS_Faults.Undertemperature_Fault": "bms.faults[3]"
"BMS.BMS_Faults.Overtemperature_Fault": "bms.faults[4]"
"BMS.BMS_Faults.Overcurrent_Fault": "bms.faults[5]"
"BMS.BMS_Faults.External_Kill_Fault": "bms.faults[6]"
"BMS.BMS_Faults.Open_Wire_Fault": "bms.faults[7]"
"BMS.BMS_Faults.Open_Wire_Temp_Fault": "???"
"BMS.BMS_Faults.Pec_Fault": "???"
"BMS.BMS_Faults.Total_PEC_Failures": "???"

# BMS SOE
"BMS.BMS_SOE.Max_Discharge_Current": "bms.soe_max_discharge_current"
"BMS.BMS_SOE.Max_Regen_Current":    "bms.soe_max_regen_current"
"BMS.BMS_SOE.Battery_Voltage":      "bms.soe_bat_voltage"
"BMS.BMS_SOE.Battery_Temperature":  "bms.soe_bat_temp"
"BMS.BMS_SOE.Battery_Current":      "bms.soe_bat_current"

# BMS Status
"BMS.BMS_Status.BMS_State":         "bms.bms_state"
"BMS.BMS_Status.IMD_State":         "???"
"BMS.BMS_Status.Max_Cell_Temp":     "???"
"BMS.BMS_Status.Min_Cell_Temp":     "???"
"BMS.BMS_Status.Max_Cell_Voltage":  "???"
"BMS.BMS_Status.Min_Cell_Voltage":  "???"
"BMS.BMS_Status.BMS_SOC":           "???"

# BMS Cell Temperatures (0–79)
{% for i in range(80) %}"BMS.BMS_Temperatures_{{ i//8 }}.Cell_T_{{ i }}": "bms.cell_temps[{{ i }}]"
{% endfor %}

# BMS Cell Voltages (0–139)
{% for i in range(140) %}"BMS.BMS_Voltages_{{ i//8 }}.Cell_V_{{ i }}": "bms.cell_voltages[{{ i }}]"
{% endfor %}

# CAN2USB Error Frame
"CAN2USB.CAN2USB_Controller_Error.Controller_Error": "???"
"CAN2USB.CAN2USB_Controller_Error_NACK_Error.Controller_Error_NACK": "???"
"CAN2USB.CAN2USB_Controller_Error_Protocol_Violation.Controller_Error_Protocol_Violation": "???"

# CANMaster Status & Responses
{% for sig in [
  "Dynamics_Status","Front_Status","Telemetry_Status",
  "ECU_Status","BMS_Status","PDM_Status",
  "BL_Status","BR_Status","FL_Status","FR_Status",
  "Dynamics_Enable_Response","Front_Enable_Response","Telemetry_Enable_Response",
  "ECU_Enable_Response","BMS_Enable_Response","PDM_Enable_Response",
  "BL_Enable_Response","BR_Enable_Response","FL_Enable_Response","FR_Enable_Response",
  "Counter"
] %}"CANMaster.CM_Node_Status_DAQ.{{ sig }}": "???"
{% endfor %}

# Wheel Corner Data — map to corners list (order BL, BR, FL, FR)
"DAQ-BL-Wheel.DAQ_Wheel_BL.BL_Speed":           "corners[0].wheel_speed"
"DAQ-BL-Wheel.DAQ_Wheel_BL.BL_Displacement":   "corners[0].raw_sus_displacement"
"DAQ-BL-Wheel.DAQ_Wheel_BL.BL_Load_Sig":       "corners[0].pr_strain"
# BL temperature sensors -> ???
# BR, FL, FR similarly -> ???

# Dynamics (front/back)
"DAQ-Back.DAQ_Coolant_Flow_Rates.Before_Motor_Flow_Rate":        "???"
"DAQ-Back.DAQ_Coolant_Flow_Rates.Before_Accumulator_Flow_Rate":  "???"
"DAQ-Back.DAQ_Coolant_Temps.Before_Motor_Temperature":          "dynamics.coolant_temps[0]"
"DAQ-Back.DAQ_Coolant_Temps.Before_Accumulator_Temperature":    "dynamics.coolant_temps[1]"
"DAQ-Back.DAQ_Dynamics_IMU_Acceleration.X_Acceleration":        "dynamics.imu.accel[0]"
"DAQ-Back.DAQ_Dynamics_IMU_Acceleration.Y_Acceleration":        "dynamics.imu.accel[1]"
"DAQ-Back.DAQ_Dynamics_IMU_Acceleration.Z_Acceleration":        "dynamics.imu.accel[2]"
"DAQ-Back.DAQ_Dynamics_IMU_Gryo.X_Angular_Speed":               "dynamics.imu.orientation[0]"
"DAQ-Back.DAQ_Dynamics_IMU_Gryo.Y_Angular_Speed":               "dynamics.imu.orientation[1]"
"DAQ-Back.DAQ_Dynamics_IMU_Gryo.Z_Angular_Speed":               "dynamics.imu.orientation[2]"

{% for j in range(8) %}"DAQ-Back.DAQ_Dynamics_Pitot_Lower.Air_Speed_{{ j }}":   "dynamics.air_speed[{{ j }}]"
"DAQ-Back.DAQ_Dynamics_Pitot_Upper.Air_Speed_{{ j+4 }}":         "dynamics.air_speed[{{ j+4 }}]"
{% endfor %}

# Steering & GPS
"DAQ-Front.DAQ_Dynamics_Steering.Steering_Angle":     "dynamics.steering_angle"
"DAQ-Telemetry.DAQ_GPS.Longitude":                   "???"
"DAQ-Telemetry.DAQ_GPS.Latitude":                    "???"
"DAQ-Telemetry.DAQ_RTC.Time_Since_1970":             "???"
"DAQ-Telemetry.DAQ_Telemetry_Status.Wireless_Status": "???"
"DAQ-Telemetry.DAQ_Telemetry_Status.Logger_Status":   "???"

# PDM
"PDM.PDM_Current.Gen_Amps":              "pdm.gen_amps"
"PDM.PDM_Current.Fan_Amps":              "pdm.fan_amps"
"PDM.PDM_Current.Pump_Amps":             "pdm.pump_amps"
"PDM.PDM_Bat_Volt.Bat_Volt":             "pdm.bat_voltage"
"PDM.PDM_Bat_Volt.Bat_Volt_Warning":     "pdm.bat_voltage_warning"
"PDM.PDM_EFuse_Reset.Reset_Gen_Efuse":   "???"
"PDM.PDM_EFuse_Reset.Reset_AC_Efuse":    "???"
"PDM.PDM_EFuse_Triggered.Gen_EFuse_Triggered": "pdm.gen_efuse_triggered"
"PDM.PDM_EFuse_Triggered.AC_EFuse_Triggered":  "???"

# Inverter
"Inverter.Inverter_Current_Draw.Ah_Drawn":       "inverter.ah_drawn"
"Inverter.Inverter_Current_Draw.Ah_Charged":     "inverter.ah_charged"
"Inverter.Inverter_Fault_Status.Fault_Code":     "inverter.fault_code"
"Inverter.Inverter_Motor_Status.RPM":            "inverter.rpm"
"Inverter.Inverter_Motor_Status.Motor_Current":  "inverter.motor_current"
"Inverter.Inverter_Motor_Status.DC_Voltage":     "inverter.dc_voltage"
"Inverter.Inverter_Motor_Status.DC_Current":     "inverter.dc_current"
"Inverter.Inverter_Power_Draw.Wh_Drawn":         "inverter.wh_drawn"
"Inverter.Inverter_Power_Draw.Wh_Charged":       "inverter.wh_charged"
"Inverter.Inverter_Temp_Status.IGBT_Temp":       "inverter.igbt_temp"
"Inverter.Inverter_Temp_Status.Motor_Temp":      "inverter.motor_temp"

# ECU
"ECU.ECU_Brake.Front_Brake_Pressure":       "ecu.brake_pressures[0]"
"ECU.ECU_Brake.Rear_Brake_Pressure":        "ecu.brake_pressures[1]"
"ECU.ECU_Brake.Brake_Pressed":              "ecu.brake_pressed"
"ECU.ECU_Drive_Status.Drive_State":         "ecu.drive_state"
{% for idx, name in enumerate([
  "Implausibility_Present","APPSs_Disagreement_Imp","BPPC_Imp",
  "Brake_Invalid_Imp","APPSs_Invalid_Imp"
]) %}"ECU.ECU_Implausibility.{{ name }}": "ecu.implausibilities[{{ idx }}]"
{% endfor %}

# Other ECU fields — no CarDB storage
"ECU.ECU_Active_Aero_Command.Active_Aero_State":       "???"
"ECU.ECU_Active_Aero_Command.Active_Aero_Position":    "???"
"ECU.ECU_BMS_Command_Message.BMS_Command":            "???"
"ECU.ECU_LUT_Response.Accel_LUT_Id_Response":         "???"
"ECU.ECU_Pump_Fan_Command.Pump_Duty_Cycle":           "???"
"ECU.ECU_Pump_Fan_Command.Fan_Duty_Cycle":            "???"
"ECU.ECU_Set_Current.Set_Current":                   "???"
"ECU.ECU_Set_Current_Brake.Set_Current_Brake":       "???"
"ECU.ECU_Temp_Limiting_Status.IGBT_Temp_Limiting":    "???"
"ECU.ECU_Temp_Limiting_Status.Battery_Temp_Limiting": "???"
"ECU.ECU_Temp_Limiting_Status.Motor_Temp_Limiting":   "???"
"ECU.ECU_Throttle.APPS1_Throttle":                    "???"
"ECU.ECU_Throttle.APPS2_Throttle":                    "???"
"ECU.ECU_Torque_Status.Torque_Status":                "???"

# IMD — no CarDB storage
"IMD.PGN_Info_General.Isolation_R_iso_corrected":     "???"
"IMD.PGN_Info_General.Isolation_R_iso_status":        "???"
"IMD.PGN_Info_General.Isolation_Measurement_Counter": "???"
"IMD.PGN_Info_General.Status_Warnings_And_Alarms":    "???"
"IMD.PGN_Info_General.Status_Device_Activity":        "???"
